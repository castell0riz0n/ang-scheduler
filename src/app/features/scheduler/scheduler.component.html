<div class="scheduler-container card">
  <div class="card-header scheduler-toolbar d-flex justify-content-between align-items-center p-2">
    <div class="btn-group" role="group" aria-label="Navigation">
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="navigate('prev')" [attr.aria-label]="'Previous ' + currentView()">
        <
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="navigate('today')" aria-label="Go to Today">
        Today
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="navigate('next')" [attr.aria-label]="'Next ' + currentView()">
        >
      </button>
    </div>

    <h5 class="scheduler-title mb-0 mx-3 text-center flex-grow-1">{{ viewTitle() }}</h5>

    <div class="btn-group" role="group" aria-label="View Modes">
      <button type="button" class="btn btn-sm" [class.btn-primary]="currentView() === 'month'" [class.btn-outline-primary]="currentView() !== 'month'" (click)="setView('month')">Month</button>
      <button type="button" class="btn btn-sm" [class.btn-primary]="currentView() === 'week'" [class.btn-outline-primary]="currentView() !== 'week'" (click)="setView('week')">Week</button>
      <button type="button" class="btn btn-sm" [class.btn-primary]="currentView() === 'day'" [class.btn-outline-primary]="currentView() !== 'day'" (click)="setView('day')">Day</button>
    </div>
  </div>

  <!-- TODO: Filter Bar Component -->
  @if (false) {
  <div class="scheduler-filters p-2 border-bottom d-flex gap-2 align-items-center" >
    <input type="text" class="form-control form-control-sm" placeholder="Search events..."
           (input)="$any($event.target).value"> <!-- Connect to filter.keyword -->
    <button class="btn btn-sm btn-outline-secondary" (click)="openDateRangePicker()">Date Range</button>
    <!-- Multi-select for types -->
  </div>
  }

  <div class="card-body scheduler-view-port p-0" [attr.aria-live]="'polite'" [attr.aria-atomic]="'true'">
    @switch (currentView()) {
      @case ('month') {
        <div #monthViewContainer>
          <app-month-view
            [days]="monthViewDays()"
            [weekDayNames]="weekDayNames()"
            [currentViewDate]="_parsedCenterDate()"
            [hoursRange]="{ start: dayStartHour(), end: dayEndHour() }"
            [locale]="locale()"
            [timeZone]="timeZone()"
            (eventDropped)="handleEventDropped($event)"
            (eventMoveEdit)="handleEventMoveEdit($event)"
            (slotClicked)="handleSlotClicked($event)"
            (eventClicked)="handleEventClicked($event)"
            (eventDeleted)="handleEventDeleted($event)"
          ></app-month-view>
        </div>
      }
      @case ('week') {
        <!-- Week View: Requires a more complex layout for hours and virtual scrolling -->
        <div #weekViewContainer class="week-view-container">
        <app-week-view
          [days]="weekViewDays()"
          [weekDayNames]="weekDayNames()"
          [currentViewDate]="_parsedCenterDate()"
          [hoursRange]="{ start: dayStartHour(), end: dayEndHour() }"
          [locale]="locale()"
          [timeZone]="timeZone()"
          (eventDropped)="handleEventDropped($event)"
          (eventMoveEdit)="handleEventMoveEdit($event)"
          (slotClicked)="handleSlotClicked($event)"
          (eventClicked)="handleEventClicked($event)"
          (eventDeleted)="handleEventDeleted($event)"
        ></app-week-view>
        </div>
      }
      @case ('day') {
        <!-- Day View: Requires layout for hours and virtual scrolling -->
        <div #dayViewContainer class="day-view-container">
        <app-day-view
          [hours]="dayViewHours()"
          [currentViewDate]="_parsedCenterDate()"
          [locale]="locale()"
          [timeZone]="timeZone()"
          (eventDropped)="handleEventDropped($event)"
          (eventMoveEdit)="handleEventMoveEdit($event)"
          (slotClicked)="handleSlotClicked($event)"
          (eventClicked)="handleEventClicked($event)"
          (eventDeleted)="handleEventDeleted($event)"
        ></app-day-view>
        </div>
      }
      @default {
        <p class="p-3">Unknown view type: {{ currentView() }}</p>
      }
    }
  </div>
  <div class="visually-hidden" aria-live="polite" aria-atomic="true">{{ getAriaLiveMessage() }}</div>
</div>
